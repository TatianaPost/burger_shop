
// VARIABLES
// adjustment
const btn__close = document.querySelector('.btn__close'); // using in --pop up--, --  --
// section --do--
// --pop up--
const sidebar__mobile = document.querySelector('.nav-sidebar__mobile');
const transfer__menu = document.querySelector('.mobile__transfer__menu');
const menu__link = document.querySelectorAll('.transfer_item_link');

sidebar__mobile.addEventListener('click', (e) => {
  e.preventDefault();
  transfer__menu.style.top = '0px';
});
btn__close.addEventListener('click', (e) => {
  transfer__menu.style.top = '-9999px';
});
menu__link.forEach(link => {
  link.addEventListener('click', (e) => {
    e.preventDefault();
    transfer__menu.style.top = '-9999px';
  });
});

// burger --slider--
$(function () {

  var coloringDots = function(index) {
    $('.burger-slider')
      .find('.bottom__dots-item')
      .eq(index)
      .addClass('active_dot')
      .siblings()
      .removeClass('active_dot');
  };

  var generateDots = function () {
    $('.burger__carousel').each(function(){
      var dot = $('<li>', {
        attr : {
          class : 'bottom__dots-item'
        },
        html : '<div class="bottom__dots-item__circle"></div>'
      });
      $('.bottom__dots-list').append(dot);
    });
  };

  generateDots();

  var moveSlide = function (container, slideNum) {
    var 
      items = container.find('.burger__carousel'),
      activeSlide = items.filter('.burger_is-active')
      reqItem = items.eq(slideNum),
      reqIndex = reqItem.index(),
      list = container.find('.burger__carousel-list'),
      duration = 500;

    if (reqItem.length) {
      list.animate({
        'left': -reqIndex * 100 + '%'
      }, duration, function () {
        activeSlide.removeClass('burger_is-active');
        reqItem.addClass('burger_is-active');
        coloringDots(slideNum);
      });
    };
  };


  $('.slider__btn').on('click', function (e) {
    e.preventDefault();

        var $this = $(this),
            container = $this.closest('.burger-slider'),
            items = $('.burger__carousel', container),
            activeItem = items.filter('.burger_is-active'),
            existedItem, edgeItem, reqItem;

    if ($this.hasClass('slider_btn_next')) {// вперед
      existedItem = activeItem.next();
      edgeItem = items.first();
    }
    if ($this.hasClass('slider_btn_prev')) { //назад
      existedItem = activeItem.prev();
      edgeItem = items.last();  
    }
    reqItem = existedItem.length ? existedItem.index() : edgeItem.index();
    
    moveSlide(container, reqItem);

  });

  $('body').on('click', '.bottom__dots-item', function(){
    var $this = $(this),
      container = $this.closest('.burger-slider'),
      index = $this.index();
    moveSlide(container, index);
    coloringDots(index);
  });

});

// burger --ingridients--
const btnIngridients = document.querySelector('.block__float-ingridients');
const floatIngridients = document.querySelector('.float-ingridients__list');
const burger__container = document.querySelector('.burger-container');

btnIngridients.addEventListener('mousemove', (e) => {
  floatIngridients.style.opacity = '1';
  floatIngridients.style.left = '100%';
  });


burger__container.addEventListener('mouseover', (e) => {
  floatIngridients.style.opacity = '0';
  floatIngridients.style.left = '-9999px';
});

// section --Team--
const team__item = document.querySelectorAll('.team__accordeon__item');
const items = document.querySelector('.team__accordeon__list');
const team__section = document.querySelector('.team');

items.addEventListener('click', (e) => {
  e.preventDefault();
  let target = e.target;

  if (target.className === 'team__accordeon__link') {
    let item = target.closest('.team__accordeon__item');
    if (item.classList.contains('team_accordeon_item_active')) {
      item.classList.toggle('team_accordeon_item_active');
    }
    else {
      team__item.forEach(function (item, index) {
        item.classList.remove('team_accordeon_item_active');
      })
      item.classList.add('team_accordeon_item_active');
    }
  }
})
// section --menu--

const menuList = document.querySelector('.menu__accordeon__list');
const menuItem = document.querySelectorAll('.menu__accordeon__item');



menuList.addEventListener('click', (e) => {
  e.preventDefault();
  let target = e.target;
  if (target.className === 'menu__accordeon__link__title') {
    let closestMenuItem = target.closest('.menu__accordeon__item');
    if (closestMenuItem.classList.contains('menu_accordeon_item_active')) {
      closestMenuItem.classList.toggle('menu_accordeon_item_active');
    }
    else {
      menuItem.forEach(function (closestMenuItem, index) {
        closestMenuItem.classList.remove('menu_accordeon_item_active');
      });
      closestMenuItem.classList.add('menu_accordeon_item_active');
    }
  }
});

// $(document).on("click", e => {
//   const $this = $(e.target);

//   if (!$this.closest(".menu__accordeon__list").length) {
//     closeItem($(".menu__accordeon__item"));
//   }
// });

// modal reviews 


function createOverlay(name, text) {

  const overlayElement = document.createElement('div');
  overlayElement.classList.add('reviews__overlay');

  const template = document.querySelector('#overlayReviews');
  overlayElement.innerHTML = template.innerHTML;

  const closeElement = overlayElement.querySelector('.reviews__overlay-close');
  closeElement.addEventListener('click', (e) => {
    e.preventDefault();
    document.body.removeChild(overlayElement);
  });
  const contentName = overlayElement.querySelector('.reviews__overlay-content__name');
  contentName.innerHTML = name;

  const contentText = overlayElement.querySelector('.reviews__overlay-content__discription');
  contentText.innerHTML = text;

  return overlayElement;
};

const openBtn = document.querySelectorAll('.review__btn__link');
const getName = document.querySelector('.review__name');
const getText = document.querySelector('.review__text');

var name = getName.innerHTML;

openBtn.forEach(evenBtn => {
  evenBtn.addEventListener('click', (e) => {
    var target = e.target;
    // var name = getText.previousSibling;
    var getText = target.previousSibling;
    var text = getText.previousSibling.innerHTML;
    const succesOverlay = createOverlay(name, text);
    document.body.appendChild(succesOverlay);
  });
});

// --one page scroll--

const sections = $('.section');
const display = $('.maincontent');
let inScroll = false;
const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

const setActiveMenuItem = itemEq => {
  $('.nav-sidebar__item')
  .eq(itemEq)
  .addClass('nav-sidebar_item_is-active')
  .siblings()
  .removeClass('nav-sidebar_item_is-active');
};

const performTransition = sectionEq => {
    const position = `${-sectionEq * 100}%`;

  if (inScroll) return;

  inScroll = true;

  sections
    .eq(sectionEq)
    .addClass('is-active')
    .siblings()
    .removeClass('is-active');
  display.css({
    transform: `translateY(${position})`,
    '-webkit-transform': `translateY(${position})`
  });
  const transitionDuration = parseInt(display.css('transition-duration')) * 1000; // time in ms
  setTimeout(() => {
    inScroll = false;
    setActiveMenuItem(sectionEq);
  }, transitionDuration + 300); // pf 300 мс проходит инерция мышки
};

const scrollToSection = direction => {
  const activeSection = sections.filter('.is-active');
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  if (direction === 'up' && prevSection.length) {
    performTransition(prevSection.index());
  }
  if (direction === 'down' && nextSection.length) {
    performTransition(nextSection.index());
  }
};


$(document).on({
  wheel : (e) => {
    const deltaY = e.originalEvent.deltaY;
    const direction = deltaY > 0
    ? 'down'
    : 'up'

      scrollToSection(direction);

  },
  keydown: e => {
    switch (e.keyCode) {
      case 40 :
        scrollToSection('down');
        break;
      case 38 :
        scrollToSection('up');
        break;
        
        break;
    
      default:
        break;
    }
  },
  touchmove: e => e.preventDefault()
});

$('[data-scroll-to]').on('click', (e) => {
  e.preventDefault();
  
  const target = parseInt($(e.currentTarget).attr('data-scroll-to'));
  performTransition(target);
  
});

if (isMobile) {
  $(document).swipe({
    swipe: function (
      event,
      direction,
      distance,
      duration,
      fingerCount,
      fingerData
    ) {
      const swipeDirection = direction === 'down' ? 'up' : 'down';
      scrollToSection(swipeDirection);
    }
  });
};

// Form

$('#form').on('submit', submitForm);

function submitForm(ev) {
  ev.preventDefault();
  var form = $(ev.target);
      request = ajaxForm(form);

  request.done(function(msg) {
    var mes = msg.mes,
        status = msg.status;
    if (status === 'OK') {
      form.append('<p class="success">' + mes + '</p>');
    } else {
      form.append('<p class="error">' + mes + '</p>');
    };
  });
  request.fail(function (jqXHR, textStatus) {
    alert("Request failed: " + textStatus);
  });
};
// Univercity function for work with all forms
var ajaxForm = function(form) {
  var data = form.serialize(),
      url = form.attr('action');
  return $.ajax({
    type: 'POST',
    url: url,
    dataType: 'JSON',
    data: data
  })
};

//Yandex map

ymaps.ready(init);

var placemarks = [
  {
    latitude: 59.97,
    longitude: 30.31,
    hintContent: '<div class="map__hint">улица Литералов дом 19 </div>',
    balloonContent: [
      '<div class="map__balloon">',
      'Самые вкусные бургеры у нас! Заходите по адресу: ул. Литералов, д. 19',
      '</div>'
    ]
  },
  {
    latitude: 59.94,
    longitude: 30.25,
    hintContent: '<div class="map__hint">Малый проспект В О, д 64</div>',
    balloonContent: [
      '<div class="map__balloon">',
      'Самые вкусные бургеры у нас! Заходите по адресу: Малый проспект В О, д 64',
      '</div>'
    ]
  },
  {
    latitude: 59.93,
    longitude: 30.34,
    hintContent: '<div class="map__hint">наб. реки ФонтанкиБ д 56 </div>',
    balloonContent: [
      '<div class="map__balloon">',
      'Самые вкусные бургеры у нас! Заходите по адресу: наб. реки ФонтанкиБ д 56',
      '</div>'
    ]
  }

];

function init() {
  var map = new ymaps.Map('map', {
    center: [59.94, 30.32],
    zoom: 12,
    controls: ['zoomControl'],
    behaviors: ['drag']
  });

  placemarks.forEach(function(obj) {
    var placemark = new ymaps.Placemark([obj.latitude, obj.longitude], {
      hintContent: obj.hintContent,
      balloonContent: obj.balloonContent.join('')
    },
    {
    iconLayout: 'default#image',
    iconImageHref: '../img/map/icon__point/map-marker.svg',
    iconImageSize: [46, 57],
    iconImageOffset: [-23, -57]
    });
    map.geoObjects.add(placemark);
  });
}
  // var placemark1 = new ymaps.Placemark([59.97, 30.31], {
  //     hintContent: '<div class="map__hint">улица Литералов дом 19 </div>',
  //     balloonContent: [
  //       '<div class="map__balloon">',
  //       'Самые вкусные бургеры у нас! Заходите по адресу: ул. Литералов, д. 19',
  //       '</div>'
  //     ].join('')
  // },
  // {
  //   iconLayout: 'default#image',
  //   iconImageHref: '../img/map/icon__point/map-marker.svg',
  //   iconImageSize: [46, 57],
  //   iconImageOffset: [-23, -57]
  // });

  // var placemark2 = new ymaps.Placemark([59.90, 30.31], {
  //     hintContent: '<div class="map__hint">улица Литералов дом 19 </div>',
  //     balloonContent: [
  //       '<div class="map__balloon">',
  //       'Самые вкусные бургеры у нас! Заходите по адресу: ул. Литералов, д. 19',
  //       '</div>'
  //     ].join('')
  // },
  // {
  //   iconLayout: 'default#image',
  //   iconImageHref: '../img/map/icon__point/map-marker.svg',
  //   iconImageSize: [46, 57],
  //   iconImageOffset: [-23, -57]
  // });

  // var placemark3 = new ymaps.Placemark([59.99, 30.31], {
  //     hintContent: '<div class="map__hint">улица Литералов дом 19 </div>',
  //     balloonContent: [
  //       '<div class="map__balloon">',
  //       'Самые вкусные бургеры у нас! Заходите по адресу: ул. Литералов, д. 19',
  //       '</div>'
  //     ].join('')
  // },
  // {
  //   iconLayout: 'default#image',
  //   iconImageHref: '../img/map/icon__point/map-marker.svg',
  //   iconImageSize: [46, 57],
  //   iconImageOffset: [-23, -57]
  // });
  // map.geoObjects.add(placemark1);
  // map.geoObjects.add(placemark2);
  // map.geoObjects.add(placemark3);
// }






//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBWQVJJQUJMRVNcbi8vIGFkanVzdG1lbnRcbmNvbnN0IGJ0bl9fY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnRuX19jbG9zZScpOyAvLyB1c2luZyBpbiAtLXBvcCB1cC0tLCAtLSAgLS1cbi8vIHNlY3Rpb24gLS1kby0tXG4vLyAtLXBvcCB1cC0tXG5jb25zdCBzaWRlYmFyX19tb2JpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2LXNpZGViYXJfX21vYmlsZScpO1xuY29uc3QgdHJhbnNmZXJfX21lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9iaWxlX190cmFuc2Zlcl9fbWVudScpO1xuY29uc3QgbWVudV9fbGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2Zlcl9pdGVtX2xpbmsnKTtcblxuc2lkZWJhcl9fbW9iaWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB0cmFuc2Zlcl9fbWVudS5zdHlsZS50b3AgPSAnMHB4Jztcbn0pO1xuYnRuX19jbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gIHRyYW5zZmVyX19tZW51LnN0eWxlLnRvcCA9ICctOTk5OXB4Jztcbn0pO1xubWVudV9fbGluay5mb3JFYWNoKGxpbmsgPT4ge1xuICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdHJhbnNmZXJfX21lbnUuc3R5bGUudG9wID0gJy05OTk5cHgnO1xuICB9KTtcbn0pO1xuXG4vLyBidXJnZXIgLS1zbGlkZXItLVxuJChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIGNvbG9yaW5nRG90cyA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgJCgnLmJ1cmdlci1zbGlkZXInKVxuICAgICAgLmZpbmQoJy5ib3R0b21fX2RvdHMtaXRlbScpXG4gICAgICAuZXEoaW5kZXgpXG4gICAgICAuYWRkQ2xhc3MoJ2FjdGl2ZV9kb3QnKVxuICAgICAgLnNpYmxpbmdzKClcbiAgICAgIC5yZW1vdmVDbGFzcygnYWN0aXZlX2RvdCcpO1xuICB9O1xuXG4gIHZhciBnZW5lcmF0ZURvdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmJ1cmdlcl9fY2Fyb3VzZWwnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgZG90ID0gJCgnPGxpPicsIHtcbiAgICAgICAgYXR0ciA6IHtcbiAgICAgICAgICBjbGFzcyA6ICdib3R0b21fX2RvdHMtaXRlbSdcbiAgICAgICAgfSxcbiAgICAgICAgaHRtbCA6ICc8ZGl2IGNsYXNzPVwiYm90dG9tX19kb3RzLWl0ZW1fX2NpcmNsZVwiPjwvZGl2PidcbiAgICAgIH0pO1xuICAgICAgJCgnLmJvdHRvbV9fZG90cy1saXN0JykuYXBwZW5kKGRvdCk7XG4gICAgfSk7XG4gIH07XG5cbiAgZ2VuZXJhdGVEb3RzKCk7XG5cbiAgdmFyIG1vdmVTbGlkZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIHNsaWRlTnVtKSB7XG4gICAgdmFyIFxuICAgICAgaXRlbXMgPSBjb250YWluZXIuZmluZCgnLmJ1cmdlcl9fY2Fyb3VzZWwnKSxcbiAgICAgIGFjdGl2ZVNsaWRlID0gaXRlbXMuZmlsdGVyKCcuYnVyZ2VyX2lzLWFjdGl2ZScpXG4gICAgICByZXFJdGVtID0gaXRlbXMuZXEoc2xpZGVOdW0pLFxuICAgICAgcmVxSW5kZXggPSByZXFJdGVtLmluZGV4KCksXG4gICAgICBsaXN0ID0gY29udGFpbmVyLmZpbmQoJy5idXJnZXJfX2Nhcm91c2VsLWxpc3QnKSxcbiAgICAgIGR1cmF0aW9uID0gNTAwO1xuXG4gICAgaWYgKHJlcUl0ZW0ubGVuZ3RoKSB7XG4gICAgICBsaXN0LmFuaW1hdGUoe1xuICAgICAgICAnbGVmdCc6IC1yZXFJbmRleCAqIDEwMCArICclJ1xuICAgICAgfSwgZHVyYXRpb24sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYWN0aXZlU2xpZGUucmVtb3ZlQ2xhc3MoJ2J1cmdlcl9pcy1hY3RpdmUnKTtcbiAgICAgICAgcmVxSXRlbS5hZGRDbGFzcygnYnVyZ2VyX2lzLWFjdGl2ZScpO1xuICAgICAgICBjb2xvcmluZ0RvdHMoc2xpZGVOdW0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfTtcblxuXG4gICQoJy5zbGlkZXJfX2J0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KCcuYnVyZ2VyLXNsaWRlcicpLFxuICAgICAgICAgICAgaXRlbXMgPSAkKCcuYnVyZ2VyX19jYXJvdXNlbCcsIGNvbnRhaW5lciksXG4gICAgICAgICAgICBhY3RpdmVJdGVtID0gaXRlbXMuZmlsdGVyKCcuYnVyZ2VyX2lzLWFjdGl2ZScpLFxuICAgICAgICAgICAgZXhpc3RlZEl0ZW0sIGVkZ2VJdGVtLCByZXFJdGVtO1xuXG4gICAgaWYgKCR0aGlzLmhhc0NsYXNzKCdzbGlkZXJfYnRuX25leHQnKSkgey8vINCy0L/QtdGA0LXQtFxuICAgICAgZXhpc3RlZEl0ZW0gPSBhY3RpdmVJdGVtLm5leHQoKTtcbiAgICAgIGVkZ2VJdGVtID0gaXRlbXMuZmlyc3QoKTtcbiAgICB9XG4gICAgaWYgKCR0aGlzLmhhc0NsYXNzKCdzbGlkZXJfYnRuX3ByZXYnKSkgeyAvL9C90LDQt9Cw0LRcbiAgICAgIGV4aXN0ZWRJdGVtID0gYWN0aXZlSXRlbS5wcmV2KCk7XG4gICAgICBlZGdlSXRlbSA9IGl0ZW1zLmxhc3QoKTsgIFxuICAgIH1cbiAgICByZXFJdGVtID0gZXhpc3RlZEl0ZW0ubGVuZ3RoID8gZXhpc3RlZEl0ZW0uaW5kZXgoKSA6IGVkZ2VJdGVtLmluZGV4KCk7XG4gICAgXG4gICAgbW92ZVNsaWRlKGNvbnRhaW5lciwgcmVxSXRlbSk7XG5cbiAgfSk7XG5cbiAgJCgnYm9keScpLm9uKCdjbGljaycsICcuYm90dG9tX19kb3RzLWl0ZW0nLCBmdW5jdGlvbigpe1xuICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KCcuYnVyZ2VyLXNsaWRlcicpLFxuICAgICAgaW5kZXggPSAkdGhpcy5pbmRleCgpO1xuICAgIG1vdmVTbGlkZShjb250YWluZXIsIGluZGV4KTtcbiAgICBjb2xvcmluZ0RvdHMoaW5kZXgpO1xuICB9KTtcblxufSk7XG5cbi8vIGJ1cmdlciAtLWluZ3JpZGllbnRzLS1cbmNvbnN0IGJ0bkluZ3JpZGllbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJsb2NrX19mbG9hdC1pbmdyaWRpZW50cycpO1xuY29uc3QgZmxvYXRJbmdyaWRpZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mbG9hdC1pbmdyaWRpZW50c19fbGlzdCcpO1xuY29uc3QgYnVyZ2VyX19jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2VyLWNvbnRhaW5lcicpO1xuXG5idG5JbmdyaWRpZW50cy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4ge1xuICBmbG9hdEluZ3JpZGllbnRzLnN0eWxlLm9wYWNpdHkgPSAnMSc7XG4gIGZsb2F0SW5ncmlkaWVudHMuc3R5bGUubGVmdCA9ICcxMDAlJztcbiAgfSk7XG5cblxuYnVyZ2VyX19jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKGUpID0+IHtcbiAgZmxvYXRJbmdyaWRpZW50cy5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuICBmbG9hdEluZ3JpZGllbnRzLnN0eWxlLmxlZnQgPSAnLTk5OTlweCc7XG59KTtcblxuLy8gc2VjdGlvbiAtLVRlYW0tLVxuY29uc3QgdGVhbV9faXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50ZWFtX19hY2NvcmRlb25fX2l0ZW0nKTtcbmNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlYW1fX2FjY29yZGVvbl9fbGlzdCcpO1xuY29uc3QgdGVhbV9fc2VjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZWFtJyk7XG5cbml0ZW1zLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBsZXQgdGFyZ2V0ID0gZS50YXJnZXQ7XG5cbiAgaWYgKHRhcmdldC5jbGFzc05hbWUgPT09ICd0ZWFtX19hY2NvcmRlb25fX2xpbmsnKSB7XG4gICAgbGV0IGl0ZW0gPSB0YXJnZXQuY2xvc2VzdCgnLnRlYW1fX2FjY29yZGVvbl9faXRlbScpO1xuICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucygndGVhbV9hY2NvcmRlb25faXRlbV9hY3RpdmUnKSkge1xuICAgICAgaXRlbS5jbGFzc0xpc3QudG9nZ2xlKCd0ZWFtX2FjY29yZGVvbl9pdGVtX2FjdGl2ZScpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRlYW1fX2l0ZW0uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCd0ZWFtX2FjY29yZGVvbl9pdGVtX2FjdGl2ZScpO1xuICAgICAgfSlcbiAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgndGVhbV9hY2NvcmRlb25faXRlbV9hY3RpdmUnKTtcbiAgICB9XG4gIH1cbn0pXG4vLyBzZWN0aW9uIC0tbWVudS0tXG5cbmNvbnN0IG1lbnVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lbnVfX2FjY29yZGVvbl9fbGlzdCcpO1xuY29uc3QgbWVudUl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudV9fYWNjb3JkZW9uX19pdGVtJyk7XG5cblxuXG5tZW51TGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuICBpZiAodGFyZ2V0LmNsYXNzTmFtZSA9PT0gJ21lbnVfX2FjY29yZGVvbl9fbGlua19fdGl0bGUnKSB7XG4gICAgbGV0IGNsb3Nlc3RNZW51SXRlbSA9IHRhcmdldC5jbG9zZXN0KCcubWVudV9fYWNjb3JkZW9uX19pdGVtJyk7XG4gICAgaWYgKGNsb3Nlc3RNZW51SXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ21lbnVfYWNjb3JkZW9uX2l0ZW1fYWN0aXZlJykpIHtcbiAgICAgIGNsb3Nlc3RNZW51SXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdtZW51X2FjY29yZGVvbl9pdGVtX2FjdGl2ZScpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG1lbnVJdGVtLmZvckVhY2goZnVuY3Rpb24gKGNsb3Nlc3RNZW51SXRlbSwgaW5kZXgpIHtcbiAgICAgICAgY2xvc2VzdE1lbnVJdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ21lbnVfYWNjb3JkZW9uX2l0ZW1fYWN0aXZlJyk7XG4gICAgICB9KTtcbiAgICAgIGNsb3Nlc3RNZW51SXRlbS5jbGFzc0xpc3QuYWRkKCdtZW51X2FjY29yZGVvbl9pdGVtX2FjdGl2ZScpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XG4vLyAgIGNvbnN0ICR0aGlzID0gJChlLnRhcmdldCk7XG5cbi8vICAgaWYgKCEkdGhpcy5jbG9zZXN0KFwiLm1lbnVfX2FjY29yZGVvbl9fbGlzdFwiKS5sZW5ndGgpIHtcbi8vICAgICBjbG9zZUl0ZW0oJChcIi5tZW51X19hY2NvcmRlb25fX2l0ZW1cIikpO1xuLy8gICB9XG4vLyB9KTtcblxuLy8gbW9kYWwgcmV2aWV3cyBcblxuXG5mdW5jdGlvbiBjcmVhdGVPdmVybGF5KG5hbWUsIHRleHQpIHtcblxuICBjb25zdCBvdmVybGF5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdyZXZpZXdzX19vdmVybGF5Jyk7XG5cbiAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjb3ZlcmxheVJldmlld3MnKTtcbiAgb3ZlcmxheUVsZW1lbnQuaW5uZXJIVE1MID0gdGVtcGxhdGUuaW5uZXJIVE1MO1xuXG4gIGNvbnN0IGNsb3NlRWxlbWVudCA9IG92ZXJsYXlFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXZpZXdzX19vdmVybGF5LWNsb3NlJyk7XG4gIGNsb3NlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheUVsZW1lbnQpO1xuICB9KTtcbiAgY29uc3QgY29udGVudE5hbWUgPSBvdmVybGF5RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3c19fb3ZlcmxheS1jb250ZW50X19uYW1lJyk7XG4gIGNvbnRlbnROYW1lLmlubmVySFRNTCA9IG5hbWU7XG5cbiAgY29uc3QgY29udGVudFRleHQgPSBvdmVybGF5RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3c19fb3ZlcmxheS1jb250ZW50X19kaXNjcmlwdGlvbicpO1xuICBjb250ZW50VGV4dC5pbm5lckhUTUwgPSB0ZXh0O1xuXG4gIHJldHVybiBvdmVybGF5RWxlbWVudDtcbn07XG5cbmNvbnN0IG9wZW5CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmV2aWV3X19idG5fX2xpbmsnKTtcbmNvbnN0IGdldE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3X19uYW1lJyk7XG5jb25zdCBnZXRUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJldmlld19fdGV4dCcpO1xuXG52YXIgbmFtZSA9IGdldE5hbWUuaW5uZXJIVE1MO1xuXG5vcGVuQnRuLmZvckVhY2goZXZlbkJ0biA9PiB7XG4gIGV2ZW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAvLyB2YXIgbmFtZSA9IGdldFRleHQucHJldmlvdXNTaWJsaW5nO1xuICAgIHZhciBnZXRUZXh0ID0gdGFyZ2V0LnByZXZpb3VzU2libGluZztcbiAgICB2YXIgdGV4dCA9IGdldFRleHQucHJldmlvdXNTaWJsaW5nLmlubmVySFRNTDtcbiAgICBjb25zdCBzdWNjZXNPdmVybGF5ID0gY3JlYXRlT3ZlcmxheShuYW1lLCB0ZXh0KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN1Y2Nlc092ZXJsYXkpO1xuICB9KTtcbn0pO1xuXG4vLyAtLW9uZSBwYWdlIHNjcm9sbC0tXG5cbmNvbnN0IHNlY3Rpb25zID0gJCgnLnNlY3Rpb24nKTtcbmNvbnN0IGRpc3BsYXkgPSAkKCcubWFpbmNvbnRlbnQnKTtcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xuY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XG5jb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcblxuY29uc3Qgc2V0QWN0aXZlTWVudUl0ZW0gPSBpdGVtRXEgPT4ge1xuICAkKCcubmF2LXNpZGViYXJfX2l0ZW0nKVxuICAuZXEoaXRlbUVxKVxuICAuYWRkQ2xhc3MoJ25hdi1zaWRlYmFyX2l0ZW1faXMtYWN0aXZlJylcbiAgLnNpYmxpbmdzKClcbiAgLnJlbW92ZUNsYXNzKCduYXYtc2lkZWJhcl9pdGVtX2lzLWFjdGl2ZScpO1xufTtcblxuY29uc3QgcGVyZm9ybVRyYW5zaXRpb24gPSBzZWN0aW9uRXEgPT4ge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gYCR7LXNlY3Rpb25FcSAqIDEwMH0lYDtcblxuICBpZiAoaW5TY3JvbGwpIHJldHVybjtcblxuICBpblNjcm9sbCA9IHRydWU7XG5cbiAgc2VjdGlvbnNcbiAgICAuZXEoc2VjdGlvbkVxKVxuICAgIC5hZGRDbGFzcygnaXMtYWN0aXZlJylcbiAgICAuc2libGluZ3MoKVxuICAgIC5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7XG4gIGRpc3BsYXkuY3NzKHtcbiAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259KWAsXG4gICAgJy13ZWJraXQtdHJhbnNmb3JtJzogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0pYFxuICB9KTtcbiAgY29uc3QgdHJhbnNpdGlvbkR1cmF0aW9uID0gcGFyc2VJbnQoZGlzcGxheS5jc3MoJ3RyYW5zaXRpb24tZHVyYXRpb24nKSkgKiAxMDAwOyAvLyB0aW1lIGluIG1zXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGluU2Nyb2xsID0gZmFsc2U7XG4gICAgc2V0QWN0aXZlTWVudUl0ZW0oc2VjdGlvbkVxKTtcbiAgfSwgdHJhbnNpdGlvbkR1cmF0aW9uICsgMzAwKTsgLy8gcGYgMzAwINC80YEg0L/RgNC+0YXQvtC00LjRgiDQuNC90LXRgNGG0LjRjyDQvNGL0YjQutC4XG59O1xuXG5jb25zdCBzY3JvbGxUb1NlY3Rpb24gPSBkaXJlY3Rpb24gPT4ge1xuICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKCcuaXMtYWN0aXZlJyk7XG4gIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XG4gIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XG5cbiAgaWYgKGRpcmVjdGlvbiA9PT0gJ3VwJyAmJiBwcmV2U2VjdGlvbi5sZW5ndGgpIHtcbiAgICBwZXJmb3JtVHJhbnNpdGlvbihwcmV2U2VjdGlvbi5pbmRleCgpKTtcbiAgfVxuICBpZiAoZGlyZWN0aW9uID09PSAnZG93bicgJiYgbmV4dFNlY3Rpb24ubGVuZ3RoKSB7XG4gICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSk7XG4gIH1cbn07XG5cblxuJChkb2N1bWVudCkub24oe1xuICB3aGVlbCA6IChlKSA9PiB7XG4gICAgY29uc3QgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcbiAgICBjb25zdCBkaXJlY3Rpb24gPSBkZWx0YVkgPiAwXG4gICAgPyAnZG93bidcbiAgICA6ICd1cCdcblxuICAgICAgc2Nyb2xsVG9TZWN0aW9uKGRpcmVjdGlvbik7XG5cbiAgfSxcbiAga2V5ZG93bjogZSA9PiB7XG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgIGNhc2UgNDAgOlxuICAgICAgICBzY3JvbGxUb1NlY3Rpb24oJ2Rvd24nKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM4IDpcbiAgICAgICAgc2Nyb2xsVG9TZWN0aW9uKCd1cCcpO1xuICAgICAgICBicmVhaztcbiAgICAgICAgXG4gICAgICAgIGJyZWFrO1xuICAgIFxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuICB0b3VjaG1vdmU6IGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpXG59KTtcblxuJCgnW2RhdGEtc2Nyb2xsLXRvXScpLm9uKCdjbGljaycsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgXG4gIGNvbnN0IHRhcmdldCA9IHBhcnNlSW50KCQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKCdkYXRhLXNjcm9sbC10bycpKTtcbiAgcGVyZm9ybVRyYW5zaXRpb24odGFyZ2V0KTtcbiAgXG59KTtcblxuaWYgKGlzTW9iaWxlKSB7XG4gICQoZG9jdW1lbnQpLnN3aXBlKHtcbiAgICBzd2lwZTogZnVuY3Rpb24gKFxuICAgICAgZXZlbnQsXG4gICAgICBkaXJlY3Rpb24sXG4gICAgICBkaXN0YW5jZSxcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgZmluZ2VyQ291bnQsXG4gICAgICBmaW5nZXJEYXRhXG4gICAgKSB7XG4gICAgICBjb25zdCBzd2lwZURpcmVjdGlvbiA9IGRpcmVjdGlvbiA9PT0gJ2Rvd24nID8gJ3VwJyA6ICdkb3duJztcbiAgICAgIHNjcm9sbFRvU2VjdGlvbihzd2lwZURpcmVjdGlvbik7XG4gICAgfVxuICB9KTtcbn07XG5cbi8vIEZvcm1cblxuJCgnI2Zvcm0nKS5vbignc3VibWl0Jywgc3VibWl0Rm9ybSk7XG5cbmZ1bmN0aW9uIHN1Ym1pdEZvcm0oZXYpIHtcbiAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIGZvcm0gPSAkKGV2LnRhcmdldCk7XG4gICAgICByZXF1ZXN0ID0gYWpheEZvcm0oZm9ybSk7XG5cbiAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uKG1zZykge1xuICAgIHZhciBtZXMgPSBtc2cubWVzLFxuICAgICAgICBzdGF0dXMgPSBtc2cuc3RhdHVzO1xuICAgIGlmIChzdGF0dXMgPT09ICdPSycpIHtcbiAgICAgIGZvcm0uYXBwZW5kKCc8cCBjbGFzcz1cInN1Y2Nlc3NcIj4nICsgbWVzICsgJzwvcD4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9ybS5hcHBlbmQoJzxwIGNsYXNzPVwiZXJyb3JcIj4nICsgbWVzICsgJzwvcD4nKTtcbiAgICB9O1xuICB9KTtcbiAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cykge1xuICAgIGFsZXJ0KFwiUmVxdWVzdCBmYWlsZWQ6IFwiICsgdGV4dFN0YXR1cyk7XG4gIH0pO1xufTtcbi8vIFVuaXZlcmNpdHkgZnVuY3Rpb24gZm9yIHdvcmsgd2l0aCBhbGwgZm9ybXNcbnZhciBhamF4Rm9ybSA9IGZ1bmN0aW9uKGZvcm0pIHtcbiAgdmFyIGRhdGEgPSBmb3JtLnNlcmlhbGl6ZSgpLFxuICAgICAgdXJsID0gZm9ybS5hdHRyKCdhY3Rpb24nKTtcbiAgcmV0dXJuICQuYWpheCh7XG4gICAgdHlwZTogJ1BPU1QnLFxuICAgIHVybDogdXJsLFxuICAgIGRhdGFUeXBlOiAnSlNPTicsXG4gICAgZGF0YTogZGF0YVxuICB9KVxufTtcblxuLy9ZYW5kZXggbWFwXG5cbnltYXBzLnJlYWR5KGluaXQpO1xuXG52YXIgcGxhY2VtYXJrcyA9IFtcbiAge1xuICAgIGxhdGl0dWRlOiA1OS45NyxcbiAgICBsb25naXR1ZGU6IDMwLjMxLFxuICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtGD0LvQuNGG0LAg0JvQuNGC0LXRgNCw0LvQvtCyINC00L7QvCAxOSA8L2Rpdj4nLFxuICAgIGJhbGxvb25Db250ZW50OiBbXG4gICAgICAnPGRpdiBjbGFzcz1cIm1hcF9fYmFsbG9vblwiPicsXG4gICAgICAn0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhINCX0LDRhdC+0LTQuNGC0LUg0L/QviDQsNC00YDQtdGB0YM6INGD0LsuINCb0LjRgtC10YDQsNC70L7Qsiwg0LQuIDE5JyxcbiAgICAgICc8L2Rpdj4nXG4gICAgXVxuICB9LFxuICB7XG4gICAgbGF0aXR1ZGU6IDU5Ljk0LFxuICAgIGxvbmdpdHVkZTogMzAuMjUsXG4gICAgaGludENvbnRlbnQ6ICc8ZGl2IGNsYXNzPVwibWFwX19oaW50XCI+0JzQsNC70YvQuSDQv9GA0L7RgdC/0LXQutGCINCSINCeLCDQtCA2NDwvZGl2PicsXG4gICAgYmFsbG9vbkNvbnRlbnQ6IFtcbiAgICAgICc8ZGl2IGNsYXNzPVwibWFwX19iYWxsb29uXCI+JyxcbiAgICAgICfQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEg0JfQsNGF0L7QtNC40YLQtSDQv9C+INCw0LTRgNC10YHRgzog0JzQsNC70YvQuSDQv9GA0L7RgdC/0LXQutGCINCSINCeLCDQtCA2NCcsXG4gICAgICAnPC9kaXY+J1xuICAgIF1cbiAgfSxcbiAge1xuICAgIGxhdGl0dWRlOiA1OS45MyxcbiAgICBsb25naXR1ZGU6IDMwLjM0LFxuICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtC90LDQsS4g0YDQtdC60Lgg0KTQvtC90YLQsNC90LrQuNCRINC0IDU2IDwvZGl2PicsXG4gICAgYmFsbG9vbkNvbnRlbnQ6IFtcbiAgICAgICc8ZGl2IGNsYXNzPVwibWFwX19iYWxsb29uXCI+JyxcbiAgICAgICfQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEg0JfQsNGF0L7QtNC40YLQtSDQv9C+INCw0LTRgNC10YHRgzog0L3QsNCxLiDRgNC10LrQuCDQpNC+0L3RgtCw0L3QutC40JEg0LQgNTYnLFxuICAgICAgJzwvZGl2PidcbiAgICBdXG4gIH1cblxuXTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgdmFyIG1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcbiAgICBjZW50ZXI6IFs1OS45NCwgMzAuMzJdLFxuICAgIHpvb206IDEyLFxuICAgIGNvbnRyb2xzOiBbJ3pvb21Db250cm9sJ10sXG4gICAgYmVoYXZpb3JzOiBbJ2RyYWcnXVxuICB9KTtcblxuICBwbGFjZW1hcmtzLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoW29iai5sYXRpdHVkZSwgb2JqLmxvbmdpdHVkZV0sIHtcbiAgICAgIGhpbnRDb250ZW50OiBvYmouaGludENvbnRlbnQsXG4gICAgICBiYWxsb29uQ29udGVudDogb2JqLmJhbGxvb25Db250ZW50LmpvaW4oJycpXG4gICAgfSxcbiAgICB7XG4gICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxuICAgIGljb25JbWFnZUhyZWY6ICcuLi9pbWcvbWFwL2ljb25fX3BvaW50L21hcC1tYXJrZXIuc3ZnJyxcbiAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcbiAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMjMsIC01N11cbiAgICB9KTtcbiAgICBtYXAuZ2VvT2JqZWN0cy5hZGQocGxhY2VtYXJrKTtcbiAgfSk7XG59XG4gIC8vIHZhciBwbGFjZW1hcmsxID0gbmV3IHltYXBzLlBsYWNlbWFyayhbNTkuOTcsIDMwLjMxXSwge1xuICAvLyAgICAgaGludENvbnRlbnQ6ICc8ZGl2IGNsYXNzPVwibWFwX19oaW50XCI+0YPQu9C40YbQsCDQm9C40YLQtdGA0LDQu9C+0LIg0LTQvtC8IDE5IDwvZGl2PicsXG4gIC8vICAgICBiYWxsb29uQ29udGVudDogW1xuICAvLyAgICAgICAnPGRpdiBjbGFzcz1cIm1hcF9fYmFsbG9vblwiPicsXG4gIC8vICAgICAgICfQodCw0LzRi9C1INCy0LrRg9GB0L3Ri9C1INCx0YPRgNCz0LXRgNGLINGDINC90LDRgSEg0JfQsNGF0L7QtNC40YLQtSDQv9C+INCw0LTRgNC10YHRgzog0YPQuy4g0JvQuNGC0LXRgNCw0LvQvtCyLCDQtC4gMTknLFxuICAvLyAgICAgICAnPC9kaXY+J1xuICAvLyAgICAgXS5qb2luKCcnKVxuICAvLyB9LFxuICAvLyB7XG4gIC8vICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxuICAvLyAgIGljb25JbWFnZUhyZWY6ICcuLi9pbWcvbWFwL2ljb25fX3BvaW50L21hcC1tYXJrZXIuc3ZnJyxcbiAgLy8gICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcbiAgLy8gICBpY29uSW1hZ2VPZmZzZXQ6IFstMjMsIC01N11cbiAgLy8gfSk7XG5cbiAgLy8gdmFyIHBsYWNlbWFyazIgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFs1OS45MCwgMzAuMzFdLCB7XG4gIC8vICAgICBoaW50Q29udGVudDogJzxkaXYgY2xhc3M9XCJtYXBfX2hpbnRcIj7Rg9C70LjRhtCwINCb0LjRgtC10YDQsNC70L7QsiDQtNC+0LwgMTkgPC9kaXY+JyxcbiAgLy8gICAgIGJhbGxvb25Db250ZW50OiBbXG4gIC8vICAgICAgICc8ZGl2IGNsYXNzPVwibWFwX19iYWxsb29uXCI+JyxcbiAgLy8gICAgICAgJ9Ch0LDQvNGL0LUg0LLQutGD0YHQvdGL0LUg0LHRg9GA0LPQtdGA0Ysg0YMg0L3QsNGBISDQl9Cw0YXQvtC00LjRgtC1INC/0L4g0LDQtNGA0LXRgdGDOiDRg9C7LiDQm9C40YLQtdGA0LDQu9C+0LIsINC0LiAxOScsXG4gIC8vICAgICAgICc8L2Rpdj4nXG4gIC8vICAgICBdLmpvaW4oJycpXG4gIC8vIH0sXG4gIC8vIHtcbiAgLy8gICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXG4gIC8vICAgaWNvbkltYWdlSHJlZjogJy4uL2ltZy9tYXAvaWNvbl9fcG9pbnQvbWFwLW1hcmtlci5zdmcnLFxuICAvLyAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxuICAvLyAgIGljb25JbWFnZU9mZnNldDogWy0yMywgLTU3XVxuICAvLyB9KTtcblxuICAvLyB2YXIgcGxhY2VtYXJrMyA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoWzU5Ljk5LCAzMC4zMV0sIHtcbiAgLy8gICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtGD0LvQuNGG0LAg0JvQuNGC0LXRgNCw0LvQvtCyINC00L7QvCAxOSA8L2Rpdj4nLFxuICAvLyAgICAgYmFsbG9vbkNvbnRlbnQ6IFtcbiAgLy8gICAgICAgJzxkaXYgY2xhc3M9XCJtYXBfX2JhbGxvb25cIj4nLFxuICAvLyAgICAgICAn0KHQsNC80YvQtSDQstC60YPRgdC90YvQtSDQsdGD0YDQs9C10YDRiyDRgyDQvdCw0YEhINCX0LDRhdC+0LTQuNGC0LUg0L/QviDQsNC00YDQtdGB0YM6INGD0LsuINCb0LjRgtC10YDQsNC70L7Qsiwg0LQuIDE5JyxcbiAgLy8gICAgICAgJzwvZGl2PidcbiAgLy8gICAgIF0uam9pbignJylcbiAgLy8gfSxcbiAgLy8ge1xuICAvLyAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcbiAgLy8gICBpY29uSW1hZ2VIcmVmOiAnLi4vaW1nL21hcC9pY29uX19wb2ludC9tYXAtbWFya2VyLnN2ZycsXG4gIC8vICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N10sXG4gIC8vICAgaWNvbkltYWdlT2Zmc2V0OiBbLTIzLCAtNTddXG4gIC8vIH0pO1xuICAvLyBtYXAuZ2VvT2JqZWN0cy5hZGQocGxhY2VtYXJrMSk7XG4gIC8vIG1hcC5nZW9PYmplY3RzLmFkZChwbGFjZW1hcmsyKTtcbiAgLy8gbWFwLmdlb09iamVjdHMuYWRkKHBsYWNlbWFyazMpO1xuLy8gfVxuXG5cblxuXG5cbiJdfQ==
